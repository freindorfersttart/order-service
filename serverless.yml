service: customer-service

provider:
  name: aws
  runtime: nodejs18.x
  region: us-east-1

  vpc:
    securityGroupIds:
      - sg-0c53a9fdbac3c3f1d
    subnetIds:
      - subnet-0db66bddd09cf4ea4
      - subnet-0025ce174e80dbd39
      - subnet-0b3d786ce9758f63d
      - subnet-04db367d4eefcbc92
      - subnet-044f588274a69635f
      - subnet-09be2de009329d2a1

  environment:
    DATABASE_URL: postgresql://postgres:SttartPg2026@sttart-finance-db.c0jcsykm0pvl.us-east-1.rds.amazonaws.com:5432/sttart_core
    JWT_SECRET: uma-super-chave-secreta

functions:
  createCustomer:
    handler: src/handlers/customers/create.create
    events:
      - httpApi:
          path: /customers
          method: post
    package:
      patterns:
        - node_modules/.prisma/client/**
        - node_modules/@prisma/client/**
        - node_modules/@prisma/client/index.js
        - prisma/schema.prisma
        - src/handlers/customers/create.ts
        - src/lib/**
        - src/middleware/**

  getCustomers:
    handler: src/handlers/customers/getAll.getAll
    events:
      - httpApi:
          path: /customers
          method: get
    package:
      patterns:
        - node_modules/.prisma/client/**
        - node_modules/@prisma/client/**
        - prisma/schema.prisma
        - src/handlers/customers/getAll.ts
        - src/lib/**
        - src/middleware/**

  createEntity:
    handler: src/handlers/entities/create.create
    events:
      - httpApi:
          path: /customers/{id}/entities
          method: post
    package:
      patterns:
        - node_modules/.prisma/client/**
        - node_modules/@prisma/client/**
        - prisma/schema.prisma
        - src/handlers/entities/create.ts
        - src/lib/**
        - src/middleware/**

  createPixKey:
    handler: src/handlers/pix/create.create
    events:
      - httpApi:
          path: /customers/{id}/pix-keys
          method: post
    package:
      patterns:
        - node_modules/.prisma/client/**
        - node_modules/@prisma/client/**
        - prisma/schema.prisma
        - src/handlers/pix/create.ts
        - src/lib/**
        - src/middleware/**

  isActive:
    handler: src/handlers/customers/isActive.isActive
    events:
      - httpApi:
          path: /customers/{id}/status
          method: patch
    package:
      patterns:
        - node_modules/.prisma/client/**
        - node_modules/@prisma/client/**
        - prisma/schema.prisma
        - src/handlers/customers/isActive.ts
        - src/lib/**
        - src/middleware/**

package:
  individually: true
